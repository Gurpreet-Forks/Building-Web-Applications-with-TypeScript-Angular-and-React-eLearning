{"version":3,"sources":["server/index.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,iBAyCA;;AAzCA,qCAAwG;AAExG,+BAA6C;AAC7C,6BAA+B;AAM/B,IAAM,MAAM,GAAG,IAAI,iBAAM,EAAE,CAAC;AAC5B,IAAM,YAAY,GAAG,IAAI,uBAAY,CAAU,YAAY,EAAE,cAAM,OAAA,CAAC,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC,EAAvB,CAAuB,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,EAAE,IAAI,CAAC,CAAC;AAChH,MAAM,CAAC,QAAQ,GAAG,YAAY,CAAC,YAAY,CAAC,UAAO,OAAO,EAAE,OAAO;;;;oBACjD,qBAAM,aAAa,CAAC,OAAO,EAAE,OAAO,CAAC,IAAI,CAAC,EAAA;;gBAArD,QAAQ,GAAG,SAA0C;gBAC3D,IAAI,QAAQ,YAAY,yBAAc,EAAE;oBACvC,sBAAO,QAAQ,EAAC;iBAChB;qBAAM;oBACA,cAAc,GAAG,IAAI,yBAAc,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC;oBACpE,sBAAO,cAAc,EAAC;iBACtB;;;;KACD,CAAC,CAAC;AACH,MAAM,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC;AAExB,SAAe,aAAa,CAAC,OAAsB,EAAE,OAAgB;;;;YAC9D,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YAExC,IAAI,IAAI,KAAK,YAAY;gBACxB,sBAAO,YAAK,CAAC,OAAO,EAAE,OAAO,CAAC,EAAC;YAChC,IAAI,IAAI,KAAK,aAAa;gBACzB,sBAAO,aAAM,CAAC,OAAO,EAAE,OAAO,CAAC,EAAC;YACjC,IAAI,IAAI,KAAK,gBAAgB;gBAC5B,sBAAO,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,EAAC;YACpC,IAAI,IAAI,KAAK,kBAAkB;gBAC9B,sBAAO,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,EAAC;YACtC,IAAI,IAAI,KAAK,kBAAkB;gBAC9B,sBAAO,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,EAAC;YACtC,IAAI,IAAI,KAAK,kBAAkB;gBAC9B,sBAAO,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,OAAO,CAAC,EAAC;YACtC,IAAI,IAAI,KAAK,gBAAgB;gBAC5B,sBAAO,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,OAAO,CAAC,EAAC;YACpC,MAAM,IAAI,sBAAW,CAAC,qBAAU,CAAC,mBAAmB,CAAC,CAAC;;;CACtD","file":"index.js","sourcesContent":["import { Server, ServerRequest, ServerResponse, ServerError, StatusCode, SessionStore } from \"phaethon\";\r\nimport { ObjectID, ObjectId } from \"mongodb\";\r\nimport { User, login, logout } from \"./user\";\r\nimport * as note from \"./note\";\r\n\r\nexport interface Session {\r\n\tuserId: ObjectID;\r\n}\r\n\r\nconst server = new Server();\r\nconst sessionStore = new SessionStore<Session>(\"session-id\", () => ({ userId: undefined }), 60 * 60 * 24, 1024);\r\nserver.listener = sessionStore.wrapListener(async (request, session) => {\r\n\tconst response = await handleRequest(request, session.data);\r\n\tif (response instanceof ServerResponse) {\r\n\t\treturn response;\r\n\t} else {\r\n\t\tconst serverResponse = new ServerResponse(JSON.stringify(response));\r\n\t\treturn serverResponse;\r\n\t}\r\n});\r\nserver.listenHttp(8800);\r\n\r\nasync function handleRequest(request: ServerRequest, session: Session): Promise<ServerResponse | Object> {\r\n\tconst path = request.path.toLowerCase();\r\n\r\n\tif (path === \"/api/login\")\r\n\t\treturn login(request, session);\r\n\tif (path === \"/api/logout\")\r\n\t\treturn logout(request, session);\r\n\tif (path === \"/api/note/list\")\r\n\t\treturn note.list(request, session);\r\n\tif (path === \"/api/note/insert\")\r\n\t\treturn note.insert(request, session);\r\n\tif (path === \"/api/note/update\")\r\n\t\treturn note.update(request, session);\r\n\tif (path === \"/api/note/remove\")\r\n\t\treturn note.remove(request, session);\r\n\tif (path === \"/api/note/find\")\r\n\t\treturn note.find(request, session);\r\n\tthrow new ServerError(StatusCode.ClientErrorNotFound);\r\n}\r\n"]}